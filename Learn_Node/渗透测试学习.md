# 渗透测试

## 渗透测试流程

第一步：确定要渗透的目标，也就是选择要测试的目标网站。

第二步：收集信息。收集目标网站的相关信息，比如操作系统，数据库，端口服务，所使用的的脚本语言，子域名以及CMS系统等等。

第三步：漏洞探测。利用收集到的信息，寻找目标的脆弱点。

第四步：漏洞利用，找到对方系统的弱点后，进一步攻克对方系统，拿到目标系统的权限。

第五步：渗透目标内网的其他主机，把获取的目标机器权限，当做跳板，进一步攻克内网其他主机。

第六步：验证漏洞与修复漏洞。

第七步：清除渗透痕迹，撰写测试报告。

## 信息收集

域名相关信息：域名注册人，联系方式，邮箱，子域名，c段，旁站等

服务器相关信息：操作系统，版本，内核，中间件，数据库，开放的端口，开放的服务。

CMS系统：使用的什么CMS系统，使用的框架。

目标的后台，敏感目录与文件。

### chrome插件

信息收集使用的chrome插件：wappalyzer，Modheader。

wappalyzer可以查看网站的

Modheader可以用来自定义请求头

### chrome的hacking语法：

- inurl:	搜索特定URL

- intext:	搜索正文内容

- intitle:	搜索标题内容

- site:	搜索特定的站点

- typefile:	搜索指定文件格式

- cache:	搜索搜索引擎缓存内容

  eg. intext:index of /	批量寻找目录遍历的漏洞

  ​	  inurl:/phpmyadmin/index.php	批量查找phpmyadmin入口

  ​	  inurl:php?id=	批量查找可能存在SQL注入的网站

  ​	  site:*.tw inurl:phpinfo.php	批量查找敏感文件

### fofa的使用

FOFA是一款网络空间安全搜索引擎，区别于百度、谷歌，在FOFA中收录的全是设备而不是网页。利用它，能够探索全球互联网资产信息，进行资产以及漏洞影响范围分析。

搜索语法：

- ip=“ip地址”	搜索指定ip地址的资产
- port=“端口号”	查找指定开放端口的服务器
- domain=“根域名”	搜索指定根域名的网站
- city=“城市”	搜索指定城市的资产
- app=“服务”	搜索开启指定服务的资产
- server=="服务器和版本"	搜索指定服务器和版本的资产

### 站长之家网站内工具的使用

#### whois的使用

whois是一个标准的互联网协议，可以用来收集网络注册信息，注册域名，IP地址等信息。

#### 邮箱反查

邮箱反查可以通过网站注册邮箱反查这个邮箱注册过哪些网站，从而快速的搜索目标资产。

#### 注册人反查

注册人反查可以通过网站的注册人来反查他注册过哪些网站，从而快速的搜索资产。

#### 电话反查

电话反查可以通过网站的注册人的电话来反查他注册过哪些网站，从而快速的搜索资产。

### 子域名、旁站、C段

旁站是从童泰服务器上的其他网站入手，提权，然后对服务器攻击，自然也就把网站攻击了。C段嗅探，每个IP有ABCD四个段，举个例子，192.168.0.1，A段就是192，B段就是168，C段就是0，D段就是1，而C段嗅探就是拿下它同一C段中的其中一台服务器，也就是说D段1-255中的一台服务器。

子域名搜索网站：phpinfo.me

旁站，C段搜索网站：www.webscan.cc

### 敏感文件扫描

扫描目标网站敏感文件也是信息收集的重要一步，如果能找到源码泄露，我们可以进一步配合代码审计工具寻找漏洞。常见的源码泄露有.git，.svn，.rar等。

### 网站后台查找

网站后台管理系统：主要用于对网站前台的信息管理，如文字、图片、影音和其他日常使用文件的发布、更新、删除等操作，同时也包括会员信息、订单信息、访客信息等的统计和管理。简单来说就是对网站数据库和文件的快熟操作和管理的系统，以使得前台内容能够得到及时更新和调整。所有后台页面一般不容易发现，需要通过特定的方式找到。

#### 通过robots.txt文件查找

robots.txt文件是用来限制一些爬虫爬取目录的文件，可以向这个文件中写入规则让爬虫无法爬取。这个文件百分之九十的网站都会存在。如果这个文件中有限制网站后台的 爬取，我们可以通过它限制的目录来知道网站后台的路径。

#### 通过谷歌语法寻找

利用site+inurl/intext/intitle配合进行查找

#### 查看网站底部管理入口

可以查看网页页面底部和网站版权信息，可能会有网站后台入口，可以直接找到后台。

### CDN绕过寻找真实IP

CDN，即内容分发网络，主要解决因传输距离和不同运营商节点造成的网络速度性能低下的问题。就是一组在不同运营商之间的对接节点上的高速缓存服务器，把用户经常访问的静态资源（例如CSS，HTML）直接缓存在CDN服务器上，当用户再次请求时，会直接分发到离用户近的节点服务器上响应给用户，当用户有实际数据交互是才会从远程web服务器上响应。

#### 判断目标是否使用了CDN服务器

- 直接ping
- 在线网站https://www.17ce.com/site对比ping出的结果，查看这些IP是否一致，如果都相同，结果都是一样，即有可能不存在CDN，否则大概率存在CDN。

#### 绕过CDN寻找真实IP方法

- 扫描子域名寻找真实IP。
  - 域名可能只有主域名使用了CDN加速，子域名并没有使用。
- 国外的网站多地ping
  - 域名可能只针对国内使用了CDN加速，国外并没有使用。
  - asm.ca.com   国外的ping网站，需要vpn
- 查询历史域名解析记录
  - 历史域名可能没有使用CDN。
  - https://x.threatbook.cn     国内的查询域名的历史解析记录
  - https://netcraft.com    国外的查询域名的历史解析记录
- 通过phpinfo信息泄露寻找真实IP，phpinfo的server_addr记录了服务器的真实IP

### 工具型站点

在渗透中，经常使用到一些工具型的网站收集信息，利用这些工具型站点我们能够快速的得到一些有用信息。

- http://www.yunxee.cn     云溪，可以获取目标的web信息，域名信息，IP信息，子域名信息。
- https://x.threatbook.cn     微步，这个网站收录了一些对方网站的情报信息，我们也可以利用这个网站来快速收集信息。
- http://whatweb.bugscaner.com     在线指纹识别网站，可以利用这个网站扫描对方的网站指纹信息。

## 暴力破解与枚举

### 弱口令

弱口令没有严格和准确的定义，通常认为被别人猜到或被破解工具破解的口令均为弱口令。弱口令指的是包含简单的数字和字母的口令，例如“123456”，“abc123”等，因为这样的口令很容易被别人破解，从而使用户的计算机面临风险，因此不推荐用户使用。

对于一些常见的服务如：ssh(root/root)，ftp(ftp/ftp)，rdp(administrator/admin@123)，如果目标服务器存在弱口令，那么便可以轻易爆破出来。对于这样的服务，我们可以使用超级弱口令工具检测对方有没有存在弱口令。

### http请求与响应

HTTP请求由三部分组成，分别是：请求行、消息报头、请求正文；HTTP响应也是由三部分组成，分别是：状态行、消息报头、响应正文，它们之间以CRLF即\r\n分割，且报头与正文之间有一个空行。在客户机与服务器之间进行请求-响应时，两种最常用到的方法是：GET和POST。

#### 请求头

method：请求方式

path：请求路径

scheme：协议类型及版本

Host：请求网站

User-Agant：浏览器的内核及版本

Accept：接受的数据类型

Accept-Encoding：可以接受的编码方式

Accept-Language：可以接受的语言

Content-type：请求数据的数据类型

Cookie：用户的登录凭证

#### GET和POST的区别

GET：

- GET请求查询的字符串（名称/值对）是URL中发送的
- GET请求可以被缓存。

POST：

- 查询字符串（名称/值对）是在POST请求的HTTP消息主体中发送的
- POST请求不会被缓存。

#### 响应

状态码：200-请求成功；301-网站重定向；404-网站不存在；500-内部服务器错误

